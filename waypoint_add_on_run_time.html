<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>Waypoints add on run time</title>
  <style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    float: left;
    width: 100%;
    height: 100%;
  }
  </style>

  <script>


  function initMap() {
    var map = null ;
    var markers = [];
    var start_waypoint = null ;
    var end_waypoint = null ;
    // var waypoints = [[{lat:29.981314, lng:30.951603}, stopover: false],[{lat:30.015385, lng:31.442045}, stopover: false]];
    var current_marker_point = null ;
    var directionsDisplay = new google.maps.DirectionsRenderer({suppressMarkers: true});
    var directionsService = new google.maps.DirectionsService();

    // Create a map object and specify the DOM element
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 30.7020059, lng: 31.0860695},
      scrollwheel: true ,
      disableDefaultUI: true,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      zoom: 8
    }); //map

    directionsDisplay.setMap(map);


    // Add the locations
    google.maps.event.addListener(map, 'click', function(event) {

      // Add marker
      map.addMarker(current_marker_point,event.latLng);

      // calculate the road route for distribution locations

      if (markers.length >= 1){

        // assign the new location for the waypoints
        // waypoints.push([{location: event.latLng, stopover: false}]);

        map.calcDistributionRoute();
      } // if

    }); // google.maps


    // Draw distribution road route
    map.calcDistributionRoute = function() {
      // console.log(waypoints[0]);
      // console.log(waypoints);
      // console.log(waypoints[waypoints.length -1]);

      var request = {
        origin: {lat:30.472428, lng:30.928462},// or new google.maps.LatLng(30.472428,30.928462)
        waypoints: [{location: {lat:29.981314, lng:30.951603}, stopover: false},{location: {lat:30.015385, lng:31.442045} , stopover: false}],
        destination: {lat:30.439667, lng:30.975588}, // or new google.maps.LatLng(30.439667,30.975588)
        optimizeWaypoints: true,
        travelMode: google.maps.DirectionsTravelMode.WALKING
      };

      directionsService.route(request, function (response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
          var route = response.routes[0];

          // If we need to print the address and full route path
          // console.log(route);
          // console.log("start: "+route.legs[0].start_address);
          // console.log("end: "+route.legs[0].end_address);
          // console.log("summary: "+route.summary);
        } else {
          console.log("directions response " + status);
        }
      });

      directionsVisible = true;
    }; //calcDistributionRoute

    // add marker
    map.addMarker = function(current_marker_point,latlng) {
      // Add default marker
      markers.push(new google.maps.Marker({
        position: latlng,
        map: map,
        icon: "markers/marker.png"
      }));

    }; // addMarker


  }; // initMap
  </script>

  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&key=AIzaSyAYCTaWEia3TFN9qJhm9x8jZSH1nCULaoM"></script>

</head>
<body onload="initMap()">
  <div id="map"></div>
</body>
</html>
